<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports Dashboard</title>
    <style>
        /* CSS styles as previously defined */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f8f9fa; /* Light background */
        }
        h1 {
            text-align: center;
            color: #333;
        }
        #dashboard {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 20px;
            background: white;
            border-radius: 5px;
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        th {
            background-color: #f2f2f2;
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid #ccc;
            padding: 20px;
            background-color: white;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        #searchForm {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .form-group {
            margin-right: 20px;
            flex: 1;
        }
        .form-group input {
            padding: 10px;
            margin-bottom: 10px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .button {
            margin: 10px 0;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #0056b3;
        }
        @media (max-width: 768px) {
            #searchForm {
                flex-direction: column;
            }
            .form-group {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

    <h1>Reports Dashboard</h1>
    <form id="searchForm">
        <div class="form-group">
            <label for="searchInput">Search:</label>
            <input type="text" id="searchInput" placeholder="Type name or ID" oninput="clearSearchCondition()">
        </div>
        <div class="form-group">
            <button class="button" type="button" id="searchButton" onclick="search()">Search</button>
        </div>
    </form>

    <form id="dateSearchForm" style="display:none;">
        <div class="form-group">
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate">
        </div>
        <div class="form-group">
            <label for="endDate">End Date:</label>
            <input type="date" id="endDate">
        </div>
        <div class="form-group">
            <button class="button" type="button" onclick="search()">Search</button>
        </div>
    </form>

    <div>
        <button class="button" onclick="showDashboard('Employee')">Show Employee Data</button>
        <button class="button" onclick="showDashboard('Bus')">Show Bus Data</button>
        <button class="button" onclick="showDashboard('Booking List')">Show Booking List</button>
    </div>

    <div id="dashboard">
        <table id="dashboardTable">
            <thead id="dashboardHeader"></thead>
            <tbody id="dashboardBody"></tbody>
        </table>
    </div>

    <div class="overlay" id="overlay" onclick="closePopup()"></div>
    <div class="popup" id="popup"></div>

    <script>
        let currentSection = '';

        function clearSearchCondition() {
            // Clear the search inputs if needed
        }

        function showDashboard(section) {
            currentSection = section;
            const dashboardBody = document.getElementById('dashboardBody');
            const dashboardHeader = document.getElementById('dashboardHeader');
            const dashboard = document.getElementById('dashboard');
            const dateSearchForm = document.getElementById('dateSearchForm');
            const searchForm = document.getElementById('searchForm');
            searchForm.style.display = 'flex';
            dashboard.style.display = 'block';
            dashboardBody.innerHTML = ''; // Clear previous content
            dashboardHeader.innerHTML = ''; // Clear previous header content
            
            if (section === 'Employee') {
                searchForm.style.display = 'flex';
                const header = `
                    <tr>
                        <th>Id</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Mobile</th>
                        <th>License Expiration</th>
                        <th>Address</th>
                        <th>Assigned Bus</th>
                    </tr>
                `;
                dashboardHeader.innerHTML = header;
                const employees = JSON.parse(localStorage.getItem('employees')) || [];
                if (employees.length === 0) {
                    dashboardBody.innerHTML = '<tr><td colspan="7">No employee data available.</td></tr>';
                } else {
                    employees.forEach(emp => {
                        dashboardBody.innerHTML += `
                            <tr>
                                <td>${emp.id}</td>
                                <td>${emp.firstName}</td>
                                <td>${emp.lastName}</td>
                                <td>${emp.mobile}</td>
                                <td>${emp.licenseExpiration}</td>
                                <td>${emp.address}</td>
                                <td>${emp.assignedBus}</td>
                            </tr>
                        `;
                    });
                }
            } else if (section === 'Bus') {
                const header = `
                    <tr>
                        <th>No</th>
                        <th>Plate Number</th>
                        <th>My File No</th>
                        <th>Motor No</th>
                        <th>Made</th>
                        <th>Chasis No</th>
                        <th>Remarks</th>
                    </tr>
                `;
                dashboardHeader.innerHTML = header;
                const buses = JSON.parse(localStorage.getItem('buses')) || [];
                if (buses.length === 0) {
                    dashboardBody.innerHTML = '<tr><td colspan="7">No bus data available.</td></tr>';
                } else {
                    buses.forEach(bus => {
                        dashboardBody.innerHTML += `
                            <tr>
                                <td>${bus.no}</td>
                                <td>${bus.plateNumber}</td>
                                <td>${bus.myFileNo}</td>
                                <td>${bus.motorNo}</td>
                                <td>${bus.made}</td>
                                <td>${bus.chasisNo}</td>
                                <td>${bus.remarks}</td>
                            </tr>
                        `;
                    });
                }
                // Set search form to read-only
                document.getElementById('searchInput').setAttribute('readonly', true);
                dateSearchForm.style.display = 'none'; // Hide date search
            } else if (section === 'Booking List') {
                const header = `
                    <tr>
                        <th>Id No</th>
                        <th>Bus No</th>
                        <th>In/Out</th>
                        <th>Company</th>
                        <th>Date</th>
                        <th>Price</th>
                        <th>Seat No</th>
                        <th>Time</th>
                    </tr>
                `;
                dashboardHeader.innerHTML = header;
                const bookingList = JSON.parse(localStorage.getItem('busList')) || [];
                if (bookingList.length === 0) {
                    dashboardBody.innerHTML = '<tr><td colspan="8">No booking list data available.</td></tr>';
                } else {
                    bookingList.forEach((booking) => {
                        dashboardBody.innerHTML += `
                            <tr>
                                <td>${booking.idNo}</td>
                                <td>${booking.busNo}</td>
                                <td>${booking.inOut}</td>
                                <td>${booking.company}</td>
                                <td>${booking.date}</td>
                                <td>$${booking.price}</td>
                                <td>${booking.seatNo}</td>
                                <td>${booking.time}</td>
                            </tr>
                        `;
                    });
                }
                dateSearchForm.style.display = 'flex'; // Show date search
                document.getElementById('searchInput').removeAttribute('readonly'); // Make the search field editable
            }

            clearSearchInputs();
        }

        function clearSearchInputs() {
            document.getElementById('searchInput').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
        }

        function search() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const dashboardBody = document.getElementById('dashboardBody');

            // Searching logic based on current section
            if (currentSection === 'Booking List') {
                const startDateInput = new Date(document.getElementById('startDate').value);
                const endDateInput = new Date(document.getElementById('endDate').value);
                const bookingList = JSON.parse(localStorage.getItem('busList')) || [];
        
                const filteredBookings = bookingList.filter(booking => {
                    const bookingDate = new Date(booking.date);
                    const isWithinDateRange = (!startDateInput || bookingDate >= startDateInput) &&
                                              (!endDateInput || bookingDate <= endDateInput);
        
                    const matchesSearchInput = booking.idNo.toLowerCase().includes(searchInput) || 
                                                booking.company.toLowerCase().includes(searchInput);
        
                    return isWithinDateRange && matchesSearchInput;
                });
        
                dashboardBody.innerHTML = ''; // Clear previous content
                if (filteredBookings.length === 0) {
                    dashboardBody.innerHTML = '<tr><td colspan="8">No bookings found for the selected criteria.</td></tr>';
                } else {
                    filteredBookings.forEach((booking) => {
                        dashboardBody.innerHTML += `
                            <tr>
                                <td>${booking.idNo}</td>
                                <td>${booking.busNo}</td>
                                <td>${booking.inOut}</td>
                                <td>${booking.company}</td>
                                <td>${booking.date}</td>
                                <td>$${booking.price}</td>
                                <td>${booking.seatNo}</td>
                                <td>${booking.time}</td>
                            </tr>
                        `;
                    });
                }
            } else if (currentSection === 'Employee') {
                const employees = JSON.parse(localStorage.getItem('employees')) || [];
                const filteredEmployees = employees.filter(emp =>
                    emp.id.toString().includes(searchInput) || 
                    emp.firstName.toLowerCase().includes(searchInput) || 
                    emp.lastName.toLowerCase().includes(searchInput)
                );
                
                dashboardBody.innerHTML = ''; // Clear previous content
                if (filteredEmployees.length === 0) {
                    dashboardBody.innerHTML = '<tr><td colspan="7">No employees found for the search criteria.</td></tr>';
                } else {
                    filteredEmployees.forEach(emp => {
                        dashboardBody.innerHTML += `
                            <tr>
                                <td>${emp.id}</td>
                                <td>${emp.firstName}</td>
                                <td>${emp.lastName}</td>
                                <td>${emp.mobile}</td>
                                <td>${emp.licenseExpiration}</td>
                                <td>${emp.address}</td>
                                <td>${emp.assignedBus}</td>
                            </tr>
                        `;
                    });
                }
            } else if (currentSection === 'Bus') {
                const buses = JSON.parse(localStorage.getItem('buses')) || [];
                const filteredBuses = buses.filter(bus =>
                    bus.plateNumber.toLowerCase().includes(searchInput) || 
                    bus.myFileNo.toString().includes(searchInput)
                );

                dashboardBody.innerHTML = ''; // Clear previous content
                if (filteredBuses.length === 0) {
                    dashboardBody.innerHTML = '<tr><td colspan="7">No buses found for the search criteria.</td></tr>';
                } else {
                    filteredBuses.forEach(bus => {
                        dashboardBody.innerHTML += `
                            <tr>
                                <td>${bus.no}</td>
                                <td>${bus.plateNumber}</td>
                                <td>${bus.myFileNo}</td>
                                <td>${bus.motorNo}</td>
                                <td>${bus.made}</td>
                                <td>${bus.chasisNo}</td>
                                <td>${bus.remarks}</td>
                            </tr>
                        `;
                    });
                }
            }
        }

        function closePopup() {
            const overlay = document.getElementById('overlay');
            const popup = document.getElementById('popup');
            overlay.style.display = 'none';
            popup.style.display = 'none';
        }
    </script>

</body>
</html>